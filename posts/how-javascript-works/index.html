<!DOCTYPE html><html lang="fa" dir="rtl"><head><meta charSet="utf-8"/><title>جاوااسکریپت چطوری کار میکنه؟<!-- --> | سید صالح شجاعی</title><meta name="description" content="بیان ساده از اینکه چطوری جاوااسکریپت اجرا | بلاگ صالح شجاعی"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><meta property="og:image" content="/posts/how-javascript-works.jpg"/><meta property="og:image:width" content="768"/><meta property="og:image:height" content="432"/><meta name="next-head-count" content="11"/><link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css"/><link rel="preload" href="/_next/static/css/c63a65562c61f901.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c63a65562c61f901.css" data-n-g=""/><link rel="preload" href="/_next/static/css/9651a65fa5b0d5bc.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9651a65fa5b0d5bc.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-38cee4c0e358b1a3.js" defer=""></script><script src="/_next/static/chunks/framework-64ad27b21261a9ce.js" defer=""></script><script src="/_next/static/chunks/main-d0ae2da8e5f83916.js" defer=""></script><script src="/_next/static/chunks/pages/_app-3ab99b407d0af227.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-677b9b304ed99070.js" defer=""></script><script src="/_next/static/chunks/337-aa284b206c6c12bc.js" defer=""></script><script src="/_next/static/chunks/67-8fe65e368e6dfb7e.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-bee4f66d121b061f.js" defer=""></script><script src="/_next/static/1gO5XO8w8M9zcy2Is44J1/_buildManifest.js" defer=""></script><script src="/_next/static/1gO5XO8w8M9zcy2Is44J1/_ssgManifest.js" defer=""></script></head><body><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><main><div class="antialiased text-gray-800 dark:bg-black dark:text-gray-400 flex flex-col justify-between min-h-screen"><header class="container px-8 mx-auto xl:px-5  max-w-screen-lg py-5 lg:py-8"><nav><div class="flex flex-wrap justify-between md:gap-10 md:flex-nowrap"><div class="flex-col items-center justify-start order-1 hidden w-full md:flex md:flex-row md:justify-end md:w-auto md:order-none md:flex-1"><a class="px-5 py-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-blue-500" href="/">خانه</a><a class="px-5 py-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-blue-500" href="/categories/">دسته‌بندی</a><a class="px-5 py-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-blue-500" href="/contact/">تماس</a></div><div class="flex justify-between flex-row-reverse w-full md:w-auto"><a class="w-28 dark:hidden" href="/"><img alt="logo" loading="lazy" width="132" height="52" decoding="async" data-nimg="1" style="color:transparent" src="/_next/static/media/logo.5075d375.svg"/></a><a class="hidden w-28 dark:block" href="/"><img alt="logo" loading="lazy" width="132" height="52" decoding="async" data-nimg="1" style="color:transparent" src="/_next/static/media/logo-white.04dab6bd.svg"/></a><button aria-label="Toggle Menu" class="px-2 py-1 ml-auto text-gray-500 rounded-md md:hidden focus:text-blue-500 focus:outline-none dark:text-gray-300 " id="headlessui-disclosure-button-:R1pd6:" type="button" aria-expanded="false" data-headlessui-state=""><svg class="w-6 h-6 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M4 5h16a1 1 0 0 1 0 2H4a1 1 0 1 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2z"></path></svg></button></div><div class="flex-col items-center justify-start order-2 hidden w-full md:flex md:flex-row md:w-auto md:flex-1 md:order-none"><a target="_self" class="px-5 py-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-blue-500" href="/meeting/">مشاوره رزومه</a><a target="_blank" class="px-5 py-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-blue-500" href="https://www.linkedin.com/in/ordinarysaleh/">لینکدین</a><a target="_blank" class="px-5 py-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-blue-500" href="https://github.com/ssshojaei">گیت‌هاب</a></div></div></nav></header><div class="antialiased text-gray-800 dark:bg-black dark:text-gray-400"><div class="container px-8 mx-auto xl:px-5  max-w-screen-lg py-5 lg:py-8 !pt-0"><div class="max-w-screen-md mx-auto "><div class="flex justify-center"><div class="flex gap-3"><a href="/categories/programming/"><span class="inline-block text-xs font-medium tracking-wider mt-5 text-blue-700">برنامه نویسی</span></a><a href="/categories/work/"><span class="inline-block text-xs font-medium tracking-wider mt-5 text-blue-700">کار</span></a><a href="/categories/introduce/"><span class="inline-block text-xs font-medium tracking-wider mt-5 text-blue-700">معرفی</span></a></div></div><h1 class="mt-2 mb-3 text-3xl font-semibold tracking-tight text-center lg:leading-snug text-brand-primary lg:text-4xl dark:text-white">جاوااسکریپت چطوری کار میکنه؟</h1><div class="flex justify-center mt-3 space-x-3 text-gray-500 "><div class="flex items-center gap-3"><div class="flex items-center gap-3 text-gray-500 dark:text-gray-400"><div class="flex items-center gap-3"><div class="relative flex-shrink-0 w-5 h-5"><img alt="صالح شجاعی" loading="lazy" width="20" height="20" decoding="async" data-nimg="1" class="rounded-full object-cover" style="color:transparent" src="/img/profile.jpg"/></div><span class="text-sm">صالح شجاعی</span></div></div><div class="flex items-center space-x-2 text-sm"><time class="text-gray-500 dark:text-gray-400" dateTime="Fri Apr 02 2021 04:30:00 GMT+0430 (Iran Daylight Time)">1400/01/13</time><span>· <!-- -->41<!-- --> دقیقه برای خواندن</span></div></div></div></div></div><div class="relative z-0 max-w-screen-lg mx-auto overflow-hidden lg:rounded-lg aspect-video"><img alt="جاوااسکریپت چطوری کار میکنه؟" loading="eager" decoding="async" data-nimg="fill" class="object-cover" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent" src="/posts/how-javascript-works.jpg"/></div><div class="container px-8 mx-auto xl:px-5 max-w-screen-lg py-5 lg:py-8"><article class="blog_styles_article___nnmy"><div class="dark:dark-theme"><p>جاوااسکریپت یکی از محبوب‌ترین زبان‌های برنامه نویسی دوران ما هست</p>
<p>خیلی‌هامون توسعه‌دهنده‌ی javascript هستیم اما نمیدونیم چطوری کار میکنه. توی این نوشته به ساده ترین شکلی که میتونم تلاش میکنم چیزی که این مدت درمورد Runtime environment مرورگرها فهمیدم رو براتون بازگو کنم.</p>
<h2 id="کامپایلری-یا-مفسری"><a class="anchor" href="#کامپایلری-یا-مفسری"><span class="icon icon-link"></span></a>کامپایلری یا مفسری؟</h2>
<p>جااسکریپت مفسری هست یا کامپایلری؟ خوب چیزی که خیلی‌هامون فکر میکنیم اینه که اسکریپتی و مفسری هست اما حقیقت یه مقدار پیچیده تر هست.
پیش از اینکه دقیق تر بررسی کنیم بهتون میگم که <strong>پاسخ هیچ کدوم نیست اما به کامپایلری نزدیک‌تر هست</strong>!</p>
<p>راز این داستان داخل نوع رفتار جاوااسکریپت با خطاها هست. زبان‌های اسکریپتی معمولاً از بالا به پایین، خط به خط اجرا میشن. این یعنی اگر خط ۵ برنامه خطایی داشته باشه، تا وقتی خط ۱ تا ۴ اجرا نشن متوجه خطا نمیشیم. اما جاوااسکریپت قبل از اجرا شدن یک بار parse میشه و خطاهاش مشخص میشه.</p>
<p><img src="/posts/how-javascript-works/fig2.png" alt="    Fig. 2: Parsing + Compilation + Execution    "/></p>
<p>این روندی هست که یک برنامه‌ی مدرن جاوااسکریپتی طی میکنه تا اجرا بشه</p>
<ol>
<li>
<p>با babel ترنسپایل میشه به JS با پشتیبانی توی مرورگرهای قدیمی</p>
</li>
<li>
<p>با webpack بسته بندی میشه</p>
</li>
<li>
<p>انجین JS کد رو parse میکنه و درخت طیبه‌ی AST (Abstract Syntax Tree) رو میسازه</p>
</li>
<li>
<p>انجین جاوااسکریپت AST رو به فایل واسط باینری تبدیل میکنه و اون فایل توسط JIT (Just In Time) تبدیل و بهینه میشه.</p>
</li>
<li>
<p>و در آخر ماشین مجازی JS رو اجرا میکنه</p>
<p>(درمورد اتفاق هایی که داخل ۳ قدم آخر افتادن پایین تر کامل توضیح میدم بهتون)</p>
</li>
</ol>
<p>همونطوری که میبینیم این فرایند به کامپایلیری بودن خیلی نزدیک تر هست یا مفسری بودن.</p>
<h2 id="یه-مرورگر-چطوری-فایل-js-رو-اجرا-میکنه"><a class="anchor" href="#یه-مرورگر-چطوری-فایل-js-رو-اجرا-میکنه"><span class="icon icon-link"></span></a>یه مرورگر چطوری فایل JS رو اجرا میکنه؟</h2>
<p>هر مرورگری (کروم، فایرفاکس، سافاری و...)، یک بخش برای اجرای جاوااسکریپت داره که یک‌سری API رو در اختیار توسعه‌دهنده ها قرار میده؛ چیزهایی مثل DOM, setTimeOut, fetch و...
این APIها جدا از خود جاوااسکریپت هستن و متودهایی هستن که مرورگر در محیط اجرای جاوااسکریپت خودش در کنار انجین اصلی JS قرار میده.</p>
<p><img src="/posts/how-javascript-works/console-log.jpg" alt="console log"/></p>
<p>شاید تعجب کنید که console و window هم جز جاوااسکریپت نیستن و توی Runtime environment ها به عنوان API اضافه میشن. بنابر این انجین جاوااسکریپت بخشی از محیط اجرای جاوااسکریپت هست. بیاید نگاهی به موتورهای معروف اجرای جاوااسکریپت بندازیم.</p>
<ul>
<li><a href="https://github.com/v8/v8">انجین V8</a> - توسط گوگل توسعه داده میشه برای کروم و آزاد هست - با C++ نوشته شده</li>
<li><a href="https://github.com/mozilla-spidermonkey">انجین SpiderMonkey</a> - توسط فایرفاکس توسعه داده میشه - اولین موتور اجرای جاوااسکریپت بوده - آزاد هست و با C, C++ و Rust نوشته شده</li>
<li><a href="https://github.com/WebKit/WebKit">انجین JavascriptCore</a> - توسط اپل و ادوبی توسعه داده میشه - با C++ نوشته شده و آزاد هست</li>
<li>انجین Chakra - توسط مایکروسافت برای اینترنت اکسپلورر توسعه داده می‌شد</li>
<li><a href="https://github.com/chakra-core/ChakraCore">انجین Chakra</a> - این سری برای Edge توسعه داده میشه</li>
<li><a href="https://github.com/jerryscript-project/jerryscript">انجین JerryScript</a> - برای اینترنت چیزها استفاده میشه و بسیار سبک هست - با C99 نوشته شده و آزاد هست</li>
</ul>
<h2 id="محیط-اجرایی-جاوااسکریپت-javascript-runtime-environment"><a class="anchor" href="#محیط-اجرایی-جاوااسکریپت-javascript-runtime-environment"><span class="icon icon-link"></span></a>محیط اجرایی جاوااسکریپت (Javascript Runtime Environment)</h2>
<p>این محیط رو مثل یک جعبه یا دربرگیرنده (Container) تصور کنید. جعبه‌ای که داخلش چندتا جعبه‌ی کوچیک تر و مستقل از هم قرار دارن. وقتی انجین جاوااسکریپت شروع به کار کنه، هر بخش از کد با توجه به کارکردش داخل یکی از این جعبه‌ها قرار میگیره.</p>
<p><img src="/posts/how-javascript-works/javascript-event-loop-step-1.png" alt="Javascript Runtime Environment"/></p>
<p>این تصویر به درک بهتر روند اجرا کمک بسیاری میکنه، بخش‌های مختلفش رو با هم بررسی میکنیم.</p>
<h2 id="heap-stack-پشتهی-حافظه"><a class="anchor" href="#heap-stack-پشتهی-حافظه"><span class="icon icon-link"></span></a>Heap Stack (پشته‌ی حافظه)</h2>
<p>این بخش از انجین اصلی جاوااسکریپت هست. زمانی که انجین به متغییرها و تعریف فانکشن‌ها میرسه، اون‌ها رو اینجا ذخیره میکنه تا بعداً زمانی که بهشون نیاز پیدا کرد ازشون استفاده کنه</p>
<h2 id="call-stack-پشتهی-اجرایی"><a class="anchor" href="#call-stack-پشتهی-اجرایی"><span class="icon icon-link"></span></a>Call Stack (پشته‌ی اجرایی)</h2>
<p>این بخش هم از انجین اصلی جاوااسکریپت هست، زمانی که کد به بخش‌های اجرایی میرسه اون‌ها رو اینجا لیست میکنه تا اجرا بشن. وقتی یک فانکشن داخل Stack لیست میشه، جاوااسکریپت به سرعت شروع به تجزیه‌ی کد میکنه، متغییرهاش رو از ‌Heap فراخونی میکنه و اگر فانکشن یا متغییر تازه‌ای نیاز داشته باشه اون رو به بالای لیست اضافه میکنه. شاید (با توجه به نوع فانکشن)، اون رو به جعبه‌ی WebAPI بفرسته تا مرورگر مسئولیتش رو به گردن بگیره.</p>
<p>وقتی فانکشن مقداری رو return کنه یا به جعبه‌ی WebAPI ارسال بشه، از لیست استک حذف میشه تا فانکشن بعدی جاش رو بگیره.
اگر انجین جاوااسکریپت یک فانکشن رو کامل حل کنه اما پاسخی return نشه، انجین به صورت پیشفرض مقدار undefined رو برمیگردونه و تابع رو از لیست اجرایی حذف میکنه.</p>
<p><img src="/posts/how-javascript-works/undefined.jpg" alt="undefined"/></p>
<p>همین تک به تک پردازش فانکشن‌ها هست که جاوااسکریپت رو به Syncronous (تک خطی) بودن معروف کرده. جاوااسکریپت در هر لحظه تنها یک کار رو انجام میده.</p>
<p>نکته: ساختار داده داخل Call Stack به صورت Last In, First Out (LIFO) هست. یعنی آخرین چیزی که اضافه شده، اولین چیزی هست که حل میشه. مثل کوله‌ای در نظر بگیرید که آخرین چیزی که داخلش گذاشتید. اولین چیزی هست که میتونید ازش بردارید. در نتیجه به جز آخرین تابع وارد شده چیزی اجرا نمیشه مگر اینکه حل بشه یا به WebAPI سپرده بشه و از لیست حذف بشه.</p>
<h2 id="webapi"><a class="anchor" href="#webapi"><span class="icon icon-link"></span></a>WebAPI</h2>
<p>وقتی که انجین جاوااسکریپت به فانکشن‌ها یا توابعی مثل event listenerها و http request ها و یا در کل فانکشن‌هایی که در زمان خاصی اعمال میشن میرسه، اون‌ها رو به اینجا میفرسته تا در زمان مناسب مرورگر بهش یادآوری کنه. مثلاً فانکشنی که به رویداد OnClick وصل شده یا ریکوئستی که به منبع خارجی فرستاده میشه. در این جور مواقع callback function اون‌ها به callback queue فرستاده میشه.</p>
<p>دلیل این روش هم کارآمد کردن جاوااسکریپت هست، اگر وقتی یک درخواست میفرسته تا نتیجه بیاد یا وقتی یک فانکشن شمارنده مشغول شمردن هست کل صفحه freeze بشه، قطعا وب به اندازه‌ی فعلی جذاب نخواهد بود. وقتی چنین شرایطی پیش میاد، اون ها رو از لیست اجرا (Call Stack) حذف میکنه و به سراغ کار بعدی میره، نتیجه که آماده شد به لیست انتظار میرسه و دوباره وارد Call Stack میشه.</p>
<h2 id="callback-queue"><a class="anchor" href="#callback-queue"><span class="icon icon-link"></span></a>Callback Queue</h2>
<p>توی این صف تمام callback functionها از سمت WebAPI داخل صف قرار میگیرن. نکته‌ی مهم اینه که <strong>این فانکشن‌ها باید تا زمان خالی شدن Call Stack صبر کنن</strong>. وقتی که پشته‌ی اجرایی کاملا خالی شد، این توابع برای اجرا شدن به اونجا اضافه میشن.
نکته‌ی مهم: ساختار داده‌ای این قسمت First In, First Out (FIFO) هست، مثل صف نونوایی که کسی که اول بیاد، اول هم میره. داخل این استک از متد push (اضافه کردن به آخر) و shift (حذف از اول) استفاده میشه.</p>
<h2 id="event-loop-حلقهی-رویداد"><a class="anchor" href="#event-loop-حلقهی-رویداد"><span class="icon icon-link"></span></a>Event Loop (حلقه‌ی رویداد)</h2>
<p>کار این بخش این هست که به شکل مداوم callback queue و call stack رو بررسی میکنه تا ببینه کی اون لیست خالی میشه یا آیا فانکشنی توی صف هست یا نه.</p>
<p>شاید زمان‌هایی باشند که callback queue و call stack هر دو خالی باشند، ولی EL (Event Loop) هرگز غیر فعال نمیشه و همیشه در حال بررسی این دو بخش هست. زمانی که اولین فانکشن به صف انتظار از سمت مرورگر وارد بشه، EL خیلی سریع Call Stack رو چک میکنه و اگر خالی بود، فانکشن رو به اونجا منتقل میکنه.</p>
<p>وقتی میگن جاوااسکریپت به صورت async یا غیر خطی اجرا میشه منظور همینه، در واقع به شکل تکنیکی این حرف درست نیست، به نظر میاد که جاوااسکریپت داره هم‌زمان چند وظیفه رو دنبال میکنه اما در واقعیت جاوااسکریپت تنها روی بالاترین وظیفه داخل لیست Call Stack کار میکنه.</p>
<h2 id="مرا-کدی-نشان-ده"><a class="anchor" href="#مرا-کدی-نشان-ده"><span class="icon icon-link"></span></a>مرا کدی نشان ده!</h2>
<pre><code class="language-javascript"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Hey, why am I last?&#x27;</span>)
}, <span class="hljs-number">0</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">sayHi</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Hello&#x27;</span>)
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">sayBye</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Goodbye&#x27;</span>)
}

<span class="hljs-title function_">sayHi</span>()
<span class="hljs-title function_">sayBye</span>()
</code></pre>
<p>خوب خروجی این کد چنین است</p>
<pre><code class="">Hello
Goodbye
Hey, why am I last?
</code></pre>
<p>با اینکه زمان انتظار setTimeOut صفر هست و پیش از همه نوشته شده اما پس از همه اجرا شده. بیاید ببینیم داخل انجین V8 چه مراحلی اتفاق افتاده.</p>
<ol>
<li>انجین یک بار کل کد رو بررسی کرده تا ببینه خطای سینتکسی داریم یا نه. خطایی نبوده پس شروع به تجزیه‌ی کد کرده</li>
<li>انجین اولین فانکشن رو به call Stack منتقل کرده</li>
<li>توی این مرحله به setTimeOut رسیده که جزئی از متدهای WebAPI هست، در نتیجه اون رو به لیست WebAPI میفرسته و از لیست callStack حذف میشه.</li>
<li>به دلیل اینکه زمان تاخیر 0 هست، WebAPI در لحظه اون رو به Callback Queue میفرسته</li>
<li>توی این مرحله Event Loop میبینه که فانکشنی برای اجرا به صف اضافه شده، Call Stack رو چک میکنه تا ببینه اگر خالیه اون صف رو به اونجا منتقل کنه، اما call Stack خالی نیست چون در حال اجرای تابع sayHi و sayBye هست.</li>
<li>در اولین لحظه‌ای که setTimeOut از call Stack حذف شد، انجین به فانکشن‌های بعدی میرسه و اون‌ها رو داخل Heap ذخیره میکنه</li>
<li>حالا به فراخوانی فانکشن sayHi میرسه اون رو به call Stack اضافه میکنه.</li>
<li>فانکشن sayHi متود console.log رو صدا میزنه و اون به بالای call stack اضافه میشه.</li>
<li>انجین سریع به سراغ console.log میره، مقدار Hello رو داخل کنسول پرینت میکنه و console.log رو از لیست خارج میکنه.</li>
<li>دوباره به فانکشن sayHi برمیگرده و میبینه چیز دیگه‌ای برای انجام دادن نیست، مقدار پیش‌فرض undefined رو برمیگردونه و فانکشن رو از callStack حذف میکنه</li>
<li>همین مراحل برای sayBye هم اتفاق می‌افته</li>
<li>حلقه‌ی رویداد (Event Loop) وقتی میبینه صف خالی شد، صف رو به callStack منتقل میکنه و سرانجام Hey, why am I last? داخل کنسول چاپ میشه.</li>
</ol>
<p>میتونید این روند رو از <a href="http://latentflip.com/loupe/?code=Ly8gZmlyc3QsIGNhbGwgdGltZW91dCBmdW5jdGlvbiwgc2V0IHRvIHplcm8gc2Vjb25kcwpzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CiAgY29uc29sZS5sb2coJ0hleSwgd2h5IGFtIEkgbGFzdD8nKTsKfSwgMCk7Ci8vIGRlY2xhcmUgdHdvIGZ1bmN0aW9ucwpmdW5jdGlvbiBzYXlIaSgpewogIGNvbnNvbGUubG9nKCdIZWxsbycpOwp9CmZ1bmN0aW9uIHNheUJ5ZSgpewogIGNvbnNvbGUubG9nKCdHb29kYnllJyk7Cn0KLy8gY2FsbCB0aGUgdHdvIGZ1bmN0aW9ucyBsYXN0CnNheUhpKCk7CnNheUJ5ZSgpOw%3D%3D!!!PGJ1dHRvbj5DbGljayBtZSE8L2J1dHRvbj4%3D">این سایت</a> به صورت آهسته و تصویری گام به گام ببینید.</p>
<p>سپاس بابت اینکه تا اینجا خوندید نوشته رو، دیدگاه هاتون رو باهام درمیون بذارید، کلی بهم روحیه میده.</p>
<h3 id="منابع"><a class="anchor" href="#منابع"><span class="icon icon-link"></span></a>منابع:</h3>
<p>https://posts.sessionstack.com/how-javascript-works-inside-the-v8-engine-5-tips-on-how-to-write-optimized-code-ac089e62b12e</p>
<p>https://github.com/getify/You-Dont-Know-JS/blob/2nd-ed/get-started/ch1.md</p>
<p>https://www.javascripttutorial.net/javascript-event-loop/</p>
<p>https://dzone.com/articles/memory-management-and-garbage-collection-in-javasc</p>
<p>https://virgool.io/@shxhryar/javascript-runtime-environment-cad9snkl9syj</p>
<p>https://medium.com/@debbie.obrien/understanding-how-javascript-works-2ed11185e234</p>
<p>https://betterprogramming.pub/how-javascript-works-1706b9b66c4d</p>
<p>www.nodesimplified.com/2017/07/javascript-top-javascript-tips-and.html</p>
<p>و سایر چیزهایی که خوندم و یاد نیست...</p>
<p>برای دیدن و ارسال دیدگاه‌ها انگار نیاز به فیل‌تر شی‌کَن دارید</p></div><div><div><div id="disqus_thread"></div></div></div><div class="flex justify-center mt-7 mb-7"><a class="px-5 py-2 text-sm text-blue-600 rounded-full dark:text-blue-500 bg-slate-50 dark:bg-slate-900" href="/">بازگشت ←</a></div></article></div></div><div class="container px-8 py-5 lg:py-8 mx-auto xl:px-5 max-w-screen-lg mt-10 border-t border-gray-100 dark:border-gray-800"><div data-transition-disabled="false" data-checked="false" class="styles_toggle-theme__ArN8x"><span aria-hidden="true">روز</span><input type="checkbox" role="switch"/><span aria-hidden="true">شب</span></div><div dir="ltr" class="text-sm text-center">Copyright © 2019 - <!-- -->2024<!-- --> | Saleh Shojaei. All rights reserved.</div></div></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"جاوااسکریپت چطوری کار میکنه؟","description":"بیان ساده از اینکه چطوری جاوااسکریپت اجرا","date":"2021-04-02","slug":"how-javascript-works","tags":["programming","work","introduce"],"content":{"compiledSource":"\"use strict\";\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = {\n    a: \"a\",\n    code: \"code\",\n    h2: \"h2\",\n    h3: \"h3\",\n    img: \"img\",\n    li: \"li\",\n    ol: \"ol\",\n    p: \"p\",\n    pre: \"pre\",\n    span: \"span\",\n    strong: \"strong\",\n    ul: \"ul\",\n    ..._provideComponents(),\n    ...props.components\n  };\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"جاوااسکریپت یکی از محبوب‌ترین زبان‌های برنامه نویسی دوران ما هست\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"خیلی‌هامون توسعه‌دهنده‌ی javascript هستیم اما نمیدونیم چطوری کار میکنه. توی این نوشته به ساده ترین شکلی که میتونم تلاش میکنم چیزی که این مدت درمورد Runtime environment مرورگرها فهمیدم رو براتون بازگو کنم.\"\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"کامپایلری-یا-مفسری\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#کامپایلری-یا-مفسری\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"کامپایلری یا مفسری؟\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"جااسکریپت مفسری هست یا کامپایلری؟ خوب چیزی که خیلی‌هامون فکر میکنیم اینه که اسکریپتی و مفسری هست اما حقیقت یه مقدار پیچیده تر هست.\\nپیش از اینکه دقیق تر بررسی کنیم بهتون میگم که \", _jsx(_components.strong, {\n        children: \"پاسخ هیچ کدوم نیست اما به کامپایلری نزدیک‌تر هست\"\n      }), \"!\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"راز این داستان داخل نوع رفتار جاوااسکریپت با خطاها هست. زبان‌های اسکریپتی معمولاً از بالا به پایین، خط به خط اجرا میشن. این یعنی اگر خط ۵ برنامه خطایی داشته باشه، تا وقتی خط ۱ تا ۴ اجرا نشن متوجه خطا نمیشیم. اما جاوااسکریپت قبل از اجرا شدن یک بار parse میشه و خطاهاش مشخص میشه.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"/posts/how-javascript-works/fig2.png\",\n        alt: \"    Fig. 2: Parsing + Compilation + Execution    \"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"این روندی هست که یک برنامه‌ی مدرن جاوااسکریپتی طی میکنه تا اجرا بشه\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsx(_components.p, {\n          children: \"با babel ترنسپایل میشه به JS با پشتیبانی توی مرورگرهای قدیمی\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsx(_components.p, {\n          children: \"با webpack بسته بندی میشه\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsx(_components.p, {\n          children: \"انجین JS کد رو parse میکنه و درخت طیبه‌ی AST (Abstract Syntax Tree) رو میسازه\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsx(_components.p, {\n          children: \"انجین جاوااسکریپت AST رو به فایل واسط باینری تبدیل میکنه و اون فایل توسط JIT (Just In Time) تبدیل و بهینه میشه.\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsx(_components.p, {\n          children: \"و در آخر ماشین مجازی JS رو اجرا میکنه\"\n        }), \"\\n\", _jsx(_components.p, {\n          children: \"(درمورد اتفاق هایی که داخل ۳ قدم آخر افتادن پایین تر کامل توضیح میدم بهتون)\"\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"همونطوری که میبینیم این فرایند به کامپایلیری بودن خیلی نزدیک تر هست یا مفسری بودن.\"\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"یه-مرورگر-چطوری-فایل-js-رو-اجرا-میکنه\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#یه-مرورگر-چطوری-فایل-js-رو-اجرا-میکنه\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"یه مرورگر چطوری فایل JS رو اجرا میکنه؟\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"هر مرورگری (کروم، فایرفاکس، سافاری و...)، یک بخش برای اجرای جاوااسکریپت داره که یک‌سری API رو در اختیار توسعه‌دهنده ها قرار میده؛ چیزهایی مثل DOM, setTimeOut, fetch و...\\nاین APIها جدا از خود جاوااسکریپت هستن و متودهایی هستن که مرورگر در محیط اجرای جاوااسکریپت خودش در کنار انجین اصلی JS قرار میده.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"/posts/how-javascript-works/console-log.jpg\",\n        alt: \"console log\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"شاید تعجب کنید که console و window هم جز جاوااسکریپت نیستن و توی Runtime environment ها به عنوان API اضافه میشن. بنابر این انجین جاوااسکریپت بخشی از محیط اجرای جاوااسکریپت هست. بیاید نگاهی به موتورهای معروف اجرای جاوااسکریپت بندازیم.\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.a, {\n          href: \"https://github.com/v8/v8\",\n          children: \"انجین V8\"\n        }), \" - توسط گوگل توسعه داده میشه برای کروم و آزاد هست - با C++ نوشته شده\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.a, {\n          href: \"https://github.com/mozilla-spidermonkey\",\n          children: \"انجین SpiderMonkey\"\n        }), \" - توسط فایرفاکس توسعه داده میشه - اولین موتور اجرای جاوااسکریپت بوده - آزاد هست و با C, C++ و Rust نوشته شده\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.a, {\n          href: \"https://github.com/WebKit/WebKit\",\n          children: \"انجین JavascriptCore\"\n        }), \" - توسط اپل و ادوبی توسعه داده میشه - با C++ نوشته شده و آزاد هست\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"انجین Chakra - توسط مایکروسافت برای اینترنت اکسپلورر توسعه داده می‌شد\"\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.a, {\n          href: \"https://github.com/chakra-core/ChakraCore\",\n          children: \"انجین Chakra\"\n        }), \" - این سری برای Edge توسعه داده میشه\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.a, {\n          href: \"https://github.com/jerryscript-project/jerryscript\",\n          children: \"انجین JerryScript\"\n        }), \" - برای اینترنت چیزها استفاده میشه و بسیار سبک هست - با C99 نوشته شده و آزاد هست\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"محیط-اجرایی-جاوااسکریپت-javascript-runtime-environment\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#محیط-اجرایی-جاوااسکریپت-javascript-runtime-environment\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"محیط اجرایی جاوااسکریپت (Javascript Runtime Environment)\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"این محیط رو مثل یک جعبه یا دربرگیرنده (Container) تصور کنید. جعبه‌ای که داخلش چندتا جعبه‌ی کوچیک تر و مستقل از هم قرار دارن. وقتی انجین جاوااسکریپت شروع به کار کنه، هر بخش از کد با توجه به کارکردش داخل یکی از این جعبه‌ها قرار میگیره.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"/posts/how-javascript-works/javascript-event-loop-step-1.png\",\n        alt: \"Javascript Runtime Environment\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"این تصویر به درک بهتر روند اجرا کمک بسیاری میکنه، بخش‌های مختلفش رو با هم بررسی میکنیم.\"\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"heap-stack-پشتهی-حافظه\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#heap-stack-پشتهی-حافظه\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"Heap Stack (پشته‌ی حافظه)\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"این بخش از انجین اصلی جاوااسکریپت هست. زمانی که انجین به متغییرها و تعریف فانکشن‌ها میرسه، اون‌ها رو اینجا ذخیره میکنه تا بعداً زمانی که بهشون نیاز پیدا کرد ازشون استفاده کنه\"\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"call-stack-پشتهی-اجرایی\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#call-stack-پشتهی-اجرایی\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"Call Stack (پشته‌ی اجرایی)\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"این بخش هم از انجین اصلی جاوااسکریپت هست، زمانی که کد به بخش‌های اجرایی میرسه اون‌ها رو اینجا لیست میکنه تا اجرا بشن. وقتی یک فانکشن داخل Stack لیست میشه، جاوااسکریپت به سرعت شروع به تجزیه‌ی کد میکنه، متغییرهاش رو از ‌Heap فراخونی میکنه و اگر فانکشن یا متغییر تازه‌ای نیاز داشته باشه اون رو به بالای لیست اضافه میکنه. شاید (با توجه به نوع فانکشن)، اون رو به جعبه‌ی WebAPI بفرسته تا مرورگر مسئولیتش رو به گردن بگیره.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"وقتی فانکشن مقداری رو return کنه یا به جعبه‌ی WebAPI ارسال بشه، از لیست استک حذف میشه تا فانکشن بعدی جاش رو بگیره.\\nاگر انجین جاوااسکریپت یک فانکشن رو کامل حل کنه اما پاسخی return نشه، انجین به صورت پیشفرض مقدار undefined رو برمیگردونه و تابع رو از لیست اجرایی حذف میکنه.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"/posts/how-javascript-works/undefined.jpg\",\n        alt: \"undefined\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"همین تک به تک پردازش فانکشن‌ها هست که جاوااسکریپت رو به Syncronous (تک خطی) بودن معروف کرده. جاوااسکریپت در هر لحظه تنها یک کار رو انجام میده.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"نکته: ساختار داده داخل Call Stack به صورت Last In, First Out (LIFO) هست. یعنی آخرین چیزی که اضافه شده، اولین چیزی هست که حل میشه. مثل کوله‌ای در نظر بگیرید که آخرین چیزی که داخلش گذاشتید. اولین چیزی هست که میتونید ازش بردارید. در نتیجه به جز آخرین تابع وارد شده چیزی اجرا نمیشه مگر اینکه حل بشه یا به WebAPI سپرده بشه و از لیست حذف بشه.\"\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"webapi\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#webapi\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"WebAPI\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"وقتی که انجین جاوااسکریپت به فانکشن‌ها یا توابعی مثل event listenerها و http request ها و یا در کل فانکشن‌هایی که در زمان خاصی اعمال میشن میرسه، اون‌ها رو به اینجا میفرسته تا در زمان مناسب مرورگر بهش یادآوری کنه. مثلاً فانکشنی که به رویداد OnClick وصل شده یا ریکوئستی که به منبع خارجی فرستاده میشه. در این جور مواقع callback function اون‌ها به callback queue فرستاده میشه.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"دلیل این روش هم کارآمد کردن جاوااسکریپت هست، اگر وقتی یک درخواست میفرسته تا نتیجه بیاد یا وقتی یک فانکشن شمارنده مشغول شمردن هست کل صفحه freeze بشه، قطعا وب به اندازه‌ی فعلی جذاب نخواهد بود. وقتی چنین شرایطی پیش میاد، اون ها رو از لیست اجرا (Call Stack) حذف میکنه و به سراغ کار بعدی میره، نتیجه که آماده شد به لیست انتظار میرسه و دوباره وارد Call Stack میشه.\"\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"callback-queue\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#callback-queue\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"Callback Queue\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"توی این صف تمام callback functionها از سمت WebAPI داخل صف قرار میگیرن. نکته‌ی مهم اینه که \", _jsx(_components.strong, {\n        children: \"این فانکشن‌ها باید تا زمان خالی شدن Call Stack صبر کنن\"\n      }), \". وقتی که پشته‌ی اجرایی کاملا خالی شد، این توابع برای اجرا شدن به اونجا اضافه میشن.\\nنکته‌ی مهم: ساختار داده‌ای این قسمت First In, First Out (FIFO) هست، مثل صف نونوایی که کسی که اول بیاد، اول هم میره. داخل این استک از متد push (اضافه کردن به آخر) و shift (حذف از اول) استفاده میشه.\"]\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"event-loop-حلقهی-رویداد\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#event-loop-حلقهی-رویداد\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"Event Loop (حلقه‌ی رویداد)\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"کار این بخش این هست که به شکل مداوم callback queue و call stack رو بررسی میکنه تا ببینه کی اون لیست خالی میشه یا آیا فانکشنی توی صف هست یا نه.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"شاید زمان‌هایی باشند که callback queue و call stack هر دو خالی باشند، ولی EL (Event Loop) هرگز غیر فعال نمیشه و همیشه در حال بررسی این دو بخش هست. زمانی که اولین فانکشن به صف انتظار از سمت مرورگر وارد بشه، EL خیلی سریع Call Stack رو چک میکنه و اگر خالی بود، فانکشن رو به اونجا منتقل میکنه.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"وقتی میگن جاوااسکریپت به صورت async یا غیر خطی اجرا میشه منظور همینه، در واقع به شکل تکنیکی این حرف درست نیست، به نظر میاد که جاوااسکریپت داره هم‌زمان چند وظیفه رو دنبال میکنه اما در واقعیت جاوااسکریپت تنها روی بالاترین وظیفه داخل لیست Call Stack کار میکنه.\"\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"مرا-کدی-نشان-ده\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#مرا-کدی-نشان-ده\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"مرا کدی نشان ده!\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"language-javascript\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"setTimeout\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-function\",\n          children: \"() =\u003e\"\n        }), \" {\\n  \", _jsx(_components.span, {\n          className: \"hljs-variable language_\",\n          children: \"console\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"log\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'Hey, why am I last?'\"\n        }), \")\\n}, \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \")\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"sayHi\"\n        }), \" = (\", _jsx(_components.span, {\n          className: \"hljs-params\"\n        }), \") =\u003e {\\n  \", _jsx(_components.span, {\n          className: \"hljs-variable language_\",\n          children: \"console\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"log\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'Hello'\"\n        }), \")\\n}\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"sayBye\"\n        }), \" = (\", _jsx(_components.span, {\n          className: \"hljs-params\"\n        }), \") =\u003e {\\n  \", _jsx(_components.span, {\n          className: \"hljs-variable language_\",\n          children: \"console\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"log\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'Goodbye'\"\n        }), \")\\n}\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"sayHi\"\n        }), \"()\\n\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"sayBye\"\n        }), \"()\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"خوب خروجی این کد چنین است\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"\",\n        children: \"Hello\\nGoodbye\\nHey, why am I last?\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"با اینکه زمان انتظار setTimeOut صفر هست و پیش از همه نوشته شده اما پس از همه اجرا شده. بیاید ببینیم داخل انجین V8 چه مراحلی اتفاق افتاده.\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"انجین یک بار کل کد رو بررسی کرده تا ببینه خطای سینتکسی داریم یا نه. خطایی نبوده پس شروع به تجزیه‌ی کد کرده\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"انجین اولین فانکشن رو به call Stack منتقل کرده\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"توی این مرحله به setTimeOut رسیده که جزئی از متدهای WebAPI هست، در نتیجه اون رو به لیست WebAPI میفرسته و از لیست callStack حذف میشه.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"به دلیل اینکه زمان تاخیر 0 هست، WebAPI در لحظه اون رو به Callback Queue میفرسته\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"توی این مرحله Event Loop میبینه که فانکشنی برای اجرا به صف اضافه شده، Call Stack رو چک میکنه تا ببینه اگر خالیه اون صف رو به اونجا منتقل کنه، اما call Stack خالی نیست چون در حال اجرای تابع sayHi و sayBye هست.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"در اولین لحظه‌ای که setTimeOut از call Stack حذف شد، انجین به فانکشن‌های بعدی میرسه و اون‌ها رو داخل Heap ذخیره میکنه\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"حالا به فراخوانی فانکشن sayHi میرسه اون رو به call Stack اضافه میکنه.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"فانکشن sayHi متود console.log رو صدا میزنه و اون به بالای call stack اضافه میشه.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"انجین سریع به سراغ console.log میره، مقدار Hello رو داخل کنسول پرینت میکنه و console.log رو از لیست خارج میکنه.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"دوباره به فانکشن sayHi برمیگرده و میبینه چیز دیگه‌ای برای انجام دادن نیست، مقدار پیش‌فرض undefined رو برمیگردونه و فانکشن رو از callStack حذف میکنه\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"همین مراحل برای sayBye هم اتفاق می‌افته\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"حلقه‌ی رویداد (Event Loop) وقتی میبینه صف خالی شد، صف رو به callStack منتقل میکنه و سرانجام Hey, why am I last? داخل کنسول چاپ میشه.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"میتونید این روند رو از \", _jsx(_components.a, {\n        href: \"http://latentflip.com/loupe/?code=Ly8gZmlyc3QsIGNhbGwgdGltZW91dCBmdW5jdGlvbiwgc2V0IHRvIHplcm8gc2Vjb25kcwpzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CiAgY29uc29sZS5sb2coJ0hleSwgd2h5IGFtIEkgbGFzdD8nKTsKfSwgMCk7Ci8vIGRlY2xhcmUgdHdvIGZ1bmN0aW9ucwpmdW5jdGlvbiBzYXlIaSgpewogIGNvbnNvbGUubG9nKCdIZWxsbycpOwp9CmZ1bmN0aW9uIHNheUJ5ZSgpewogIGNvbnNvbGUubG9nKCdHb29kYnllJyk7Cn0KLy8gY2FsbCB0aGUgdHdvIGZ1bmN0aW9ucyBsYXN0CnNheUhpKCk7CnNheUJ5ZSgpOw%3D%3D!!!PGJ1dHRvbj5DbGljayBtZSE8L2J1dHRvbj4%3D\",\n        children: \"این سایت\"\n      }), \" به صورت آهسته و تصویری گام به گام ببینید.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"سپاس بابت اینکه تا اینجا خوندید نوشته رو، دیدگاه هاتون رو باهام درمیون بذارید، کلی بهم روحیه میده.\"\n    }), \"\\n\", _jsxs(_components.h3, {\n      id: \"منابع\",\n      children: [_jsx(_components.a, {\n        className: \"anchor\",\n        href: \"#منابع\",\n        children: _jsx(_components.span, {\n          className: \"icon icon-link\"\n        })\n      }), \"منابع:\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"https://posts.sessionstack.com/how-javascript-works-inside-the-v8-engine-5-tips-on-how-to-write-optimized-code-ac089e62b12e\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"https://github.com/getify/You-Dont-Know-JS/blob/2nd-ed/get-started/ch1.md\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"https://www.javascripttutorial.net/javascript-event-loop/\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"https://dzone.com/articles/memory-management-and-garbage-collection-in-javasc\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"https://virgool.io/@shxhryar/javascript-runtime-environment-cad9snkl9syj\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"https://medium.com/@debbie.obrien/understanding-how-javascript-works-2ed11185e234\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"https://betterprogramming.pub/how-javascript-works-1706b9b66c4d\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"www.nodesimplified.com/2017/07/javascript-top-javascript-tips-and.html\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"و سایر چیزهایی که خوندم و یاد نیست...\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"برای دیدن و ارسال دیدگاه‌ها انگار نیاز به فیل‌تر شی‌کَن دارید\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = {\n    ..._provideComponents(),\n    ...props.components\n  };\n  return MDXLayout ? _jsx(MDXLayout, {\n    ...props,\n    children: _jsx(_createMdxContent, {\n      ...props\n    })\n  }) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}},"coverImage":"/posts/how-javascript-works.jpg","timeToRead":41}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"how-javascript-works"},"buildId":"1gO5XO8w8M9zcy2Is44J1","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>